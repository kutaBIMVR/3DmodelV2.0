<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>è‡ªåŠ¨åŠ è½½ FBX - qiangti.FBX</title>
    <!-- å¼•å…¥ Three.js æ ¸å¿ƒåº“ä»¥åŠ FBXLoader å’Œè½¨é“æ§åˆ¶å™¨ -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.128.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.128.0/examples/jsm/"
            }
        }
    </script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', sans-serif;
            overflow: hidden;
            background-color: #111;
            color: white;
        }
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            padding: 15px 25px;
            border-radius: 30px;
            pointer-events: none;
            backdrop-filter: blur(5px);
            border-left: 5px solid #ffaa00;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            z-index: 100;
        }
        #status {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20,20,30,0.9);
            padding: 15px 30px;
            border-radius: 50px;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
            color: #0ff;
            font-weight: 300;
            border-bottom: 3px solid #0ff;
            z-index: 200;
            font-size: 16px;
            letter-spacing: 2px;
        }
        .hint {
            position: absolute;
            bottom: 120px;
            left: 30px;
            color: rgba(255,255,255,0.5);
            font-size: 12px;
            background: rgba(0,0,0,0.3);
            padding: 8px 16px;
            border-radius: 20px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="info">
        <h2>ğŸ—ï¸ è‡ªåŠ¨åŠ è½½æœ¬åœ° FBX æ¨¡å‹</h2>
        <p style="margin:0; opacity:0.9;">æ­£åœ¨åŠ è½½åŒç›®å½•ä¸‹çš„ <strong style="color:#ffaa00;">qiangti.FBX</strong> æ–‡ä»¶</p>
    </div>

    <div id="status">âš™ï¸ çŠ¶æ€: å‡†å¤‡åŠ è½½æ¨¡å‹...</div>
    
    <div class="hint">
        ğŸ–±ï¸ é¼ æ ‡æ‹–æ‹½æ—‹è½¬ | æ»šè½®ç¼©æ”¾ | å³é”®å¹³ç§» | è‡ªåŠ¨æ—‹è½¬ä¸­
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { FBXLoader } from 'three/addons/loaders/FBXLoader.js';

        // --- åˆå§‹åŒ–åœºæ™¯ã€ç›¸æœºã€æ¸²æŸ“å™¨ ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x111122);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(5, 5, 10);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // --- æ§åˆ¶å™¨ ---
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.screenSpacePanning = true;
        controls.maxDistance = 500;
        controls.minDistance = 0.1;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 1.5;
        controls.enableZoom = true;
        controls.target.set(0, 0, 0);

        // --- ç¯å…‰ç³»ç»Ÿ ---
        const ambientLight = new THREE.AmbientLight(0x404060);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffeedd, 1);
        dirLight.position.set(2, 5, 5);
        dirLight.castShadow = true;
        dirLight.receiveShadow = true;
        dirLight.shadow.mapSize.width = 1024;
        dirLight.shadow.mapSize.height = 1024;
        scene.add(dirLight);

        const backLight = new THREE.DirectionalLight(0xccddff, 0.5);
        backLight.position.set(-5, 0, -5);
        scene.add(backLight);

        const sideLight = new THREE.PointLight(0x88aaff, 0.3);
        sideLight.position.set(0, 3, 10);
        scene.add(sideLight);

        // --- è¾…åŠ©å·¥å…· ---
        const gridHelper = new THREE.GridHelper(20, 20, 0x88aaff, 0x445566);
        scene.add(gridHelper);
        
        const axesHelper = new THREE.AxesHelper(5);
        scene.add(axesHelper);

        // å­˜å‚¨å½“å‰æ¨¡å‹
        let currentModel = null;

        // --- çŠ¶æ€æ˜¾ç¤ºå‡½æ•° ---
        function setStatus(message, isError = false) {
            const statusEl = document.getElementById('status');
            statusEl.innerHTML = `âš™ï¸ çŠ¶æ€: ${message}`;
            statusEl.style.color = isError ? '#ff8888' : '#0ff';
            statusEl.style.borderBottomColor = isError ? '#ff4444' : '#0ff';
        }

        // --- ç›´æ¥åŠ è½½åŒç›®å½•ä¸‹çš„ qiangti.FBX ---
        setStatus('æ­£åœ¨åŠ è½½ qiangti.FBX...');
        
        const loader = new FBXLoader();
     loader.load('https://kutabimvr.github.io/3DmodelV2.0/qiangti.FBX', 
            (object) => {
                // æˆåŠŸå›è°ƒ
                setStatus('âœ… æˆåŠŸåŠ è½½: qiangti.FBX');
                
                // ç§»é™¤ä¹‹å‰çš„æ¨¡å‹
                if (currentModel) {
                    scene.remove(currentModel);
                    currentModel = null;
                }
                
                // --- è‡ªåŠ¨ç¼©æ”¾å’Œå±…ä¸­å¤„ç† ---
                // è®¡ç®—æ¨¡å‹å°ºå¯¸å¹¶è‡ªåŠ¨ç¼©æ”¾ä»¥é€‚åº”è§†å›¾
                const box = new THREE.Box3().setFromObject(object);
                const size = box.getSize(new THREE.Vector3());
                
                // ç¡®å®šç¼©æ”¾æ¯”ä¾‹ï¼Œä½¿å¾—æœ€å¤§å°ºå¯¸ä¸º5å·¦å³
                const maxDim = Math.max(size.x, size.y, size.z);
                const scale = maxDim > 0 ? 5.0 / maxDim : 1;
                object.scale.setScalar(scale);
                
                // é‡æ–°è®¡ç®—è¾¹ç•Œç›’ä»¥è·å¾—ç¼©æ”¾åçš„ä¸­å¿ƒ
                const scaledBox = new THREE.Box3().setFromObject(object);
                const scaledCenter = scaledBox.getCenter(new THREE.Vector3());
                
                // å°†æ¨¡å‹ç½®äºåŸç‚¹ä¸­å¿ƒ
                object.position.x -= scaledCenter.x;
                object.position.y -= scaledCenter.y;
                object.position.z -= scaledCenter.z;
                
                // æŠ¬å‡åˆ°ç½‘æ ¼å¹³é¢
                const updatedBox = new THREE.Box3().setFromObject(object);
                const minY = updatedBox.min.y;
                object.position.y += -minY;

                // éå†æ¨¡å‹ï¼Œå¯ç”¨é˜´å½±
                object.traverse((child) => {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = true;
                        
                        // è°ƒæ•´æè´¨æ•ˆæœ
                        if (child.material) {
                            if (Array.isArray(child.material)) {
                                child.material.forEach(mat => {
                                    if (mat) {
                                        if (mat.roughness !== undefined) mat.roughness = 0.6;
                                        if (mat.metalness !== undefined) mat.metalness = 0.2;
                                    }
                                });
                            } else {
                                if (child.material.roughness !== undefined) child.material.roughness = 0.6;
                                if (child.material.metalness !== undefined) child.material.metalness = 0.2;
                            }
                        }
                    }
                });
                
                scene.add(object);
                currentModel = object;
                
                // ä¿æŒè‡ªåŠ¨æ—‹è½¬
                controls.autoRotate = true;
            },
            (progress) => {
                // è¿›åº¦å›è°ƒ
                if (progress.lengthComputable) {
                    const percent = Math.round((progress.loaded / progress.total) * 100);
                    setStatus(`åŠ è½½ä¸­: ${percent}%`);
                }
            },
            (error) => {
                // é”™è¯¯å›è°ƒ
                console.error('FBXåŠ è½½é”™è¯¯:', error);
                setStatus(`âŒ åŠ è½½å¤±è´¥: è¯·ç¡®è®¤ qiangti.FBX æ–‡ä»¶åœ¨åŒçº§ç›®å½•`, true);
                
                // åœ¨æ§åˆ¶å°è¾“å‡ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
                console.error('è¯¦ç»†é”™è¯¯:', error);
            }
        );

        // --- çª—å£å¤§å°è‡ªé€‚åº” ---
        window.addEventListener('resize', onWindowResize, false);
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // --- åŠ¨ç”»å¾ªç¯ ---
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // æ§åˆ¶å°æç¤º
        console.log('Three.js è‡ªåŠ¨åŠ è½½ qiangti.FBX æŸ¥çœ‹å™¨å·²å¯åŠ¨');
    </script>
</body>
</html>